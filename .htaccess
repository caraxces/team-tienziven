AddDefaultCharset utf-8
<IfModule mod_deflate.c>
    # Bật compression cho các kiểu MIME phổ biến
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript
    AddOutputFilterByType DEFLATE application/javascript application/x-javascript application/json
    AddOutputFilterByType DEFLATE application/xml application/xhtml+xml application/rss+xml
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# Bật caching cho tệp tĩnh
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Mặc định - cache trong 1 tháng
    ExpiresDefault "access plus 1 month"
    
    # CSS và JS - 1 năm
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType application/x-javascript "access plus 1 year"
    
    # Hình ảnh - 1 năm
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    
    # Fonts - 1 năm
    ExpiresByType application/font-woff "access plus 1 year"
    ExpiresByType application/font-woff2 "access plus 1 year"
    ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
    ExpiresByType application/x-font-ttf "access plus 1 year"
    ExpiresByType font/opentype "access plus 1 year"
</IfModule>

<IfModule mod_rewrite.c>
RewriteEngine on
RewriteCond $1 !^(index\.php|resources|robots\.txt)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php?/$1 [L,QSA]
</IfModule>
# Disabled HTTPS redirection for Docker environment
#<IfModule mod_rewrite.c>
#RewriteEngine On
#RewriteCond %{HTTPS} !=on
#RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]  
#</IfModule>

# Disable directory listing
Options All -Indexes

# Remove index.php from URL
RewriteCond %{HTTP:X-Requested-With}    !^XMLHttpRequest$
RewriteCond %{THE_REQUEST}              ^[^/]*/index\.php [NC]
RewriteRule ^index\.php(.*)$            $1 [R=301,NS,L]

<Files .htaccess>
  Order allow,deny
  Deny from all
</Files>

# Start of file security
<Files ~ "^.*\.(old|orig|original|php#|php~|php_bak|save|swo|aspx?|tpl|sh|bash|bak?|cfg|cgi|dll|exe|git|hg|ini|jsp|log|mdb|out|sql|svn|swp|tar|rdf|gz|zip|bz2|7z)$">
  deny from all
</Files>

<Files ~ "\.(env|config\.php|config\.inc\.php)$">
  deny from all
</Files>
# End of file security

# Disallow HTTP methods other than GET and POST
RewriteCond %{REQUEST_METHOD} !^(GET|POST)
RewriteRule .* - [R=405,L]

<Files config/database.php>
  deny from all
</Files>

# Start of server headers
# Only if Apache headers module is available
<IfModule mod_headers.c>
  # Make sure proxies and browsers don't cache these URLs
  <FilesMatch "(?i)^.*(\.html?|\.xml)$">
    Header append Cache-Control "public, must-revalidate"
  </FilesMatch>

  # Properly handle image cache
  <FilesMatch "(?i)^.*\.(gif|png|jpe?g|webp|swf|flv|ico|xml|txt|pdf|css|js)$">
    Header append Cache-Control "public"
  </FilesMatch>
</IfModule>
# End of server headers

# Disable server signature
ServerSignature Off